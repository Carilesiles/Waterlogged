#base robot_standard.pop
#base robot_giant.pop

tomboy
{
	StartingCurrency 1984
	CanBotsAttackWhileInSpawnRoom no
	RespawnWaveTime 0
    
    LuaScript"function vitasawOnHit(_, activat, calle) local teamCheckInstance = ents.FindByName('vitasaw_team_check'); teamCheckInstance:AcceptInput('TestActivator',_,calle,activat); activat:SetName('vitasaw_caller');
    end"

    PrecacheModel "models/props_mvm/mvm_comically_small_player_shield.mdl"

	PointTemplates
	{
        FreelanceMercenary_Logic
        {
            OnSpawnOutput 
            {
                Target "freelance_action_check"
                Action "Trigger"
                Delay 0
            }

            OnSpawnOutput 
            {
                Target "!activator"
                Action "$GetVar$PreFreelanceSwitchHealth"
                Param "apply_last_health|$SetKey$CompareValue|-1"
                Delay 0
            }

            OnSpawnOutput 
            {
                Target "apply_last_health"
                Action "Compare"
                Delay 0.06
            }

            //apply health from previous class if switched
            logic_compare
            {
                "targetname" "apply_last_health"

                "InitialValue" "-1"

                "OnNotEqualTo" "!activator,$SetKey$health,$$=!activator.PreFreelanceSwitchHealth,-1,-1"
                "OnNotEqualTo" "!activator,$SetVar$PreFreelanceSwitchHealth,,0,-1"
            }

            $filter_sendprop
			{
				"targetname" "using_action"
				"$name" "m_bUsingActionSlot"
				"$value" "0"
				"$compare" "equal"
				"Negated" "1"

                "OnPass" "!activator,$SetVar$PreFreelanceSwitchHealth,$$= !activator.m_iHealth ,-1,-1"
                "OnPass" "!activator,$SwitchClassInPlace,$$= test ( !activator.m_iClass + 1 <= 9 , !activator.m_iClass + 1, 1 ) ,0,-1"
			}

            logic_relay
            {
                "targetname" "freelance_action_check"
                "spawnflags" "2"

                "OnTrigger" "using_action,TestActivator,,0,-1"
                "OnTrigger" "!self,Trigger,,0.1,-1"
            }
        }

        BabyFace_Spawn 
        {
            OnSpawnOutput
			{
				Target "bbfb_relay"
				Action "Trigger"
			}

			logic_relay 
			{
				"targetname" "bbfb_relay"
				"spawnflags" "2"

				
				"OnTrigger" "filter_has_maxcharge,TestActivator,,0,-1"
				"OnTrigger" "!self,Trigger,,0.2,-1"
			}

            $filter_sendprop
            {
                "targetname" "filter_has_maxcharge"
                "$name" "m_flHypeMeter"
                "$value" "99"
                "$compare" "greater than or equal"
                "Negated" "0"

				"OnPass" "!activator,$AddItemAttribute,add cond when active|46|0,0,-1"
				"OnPass" "!activator,$AddItemAttribute,reload time increased hidden|0.7|0,0,-1"
				"OnPass" "!activator,$AddItemAttribute,fire rate bonus HIDDEN|0.8|0,0,-1"

				"OnFail" "!activator,$RemoveItemAttribute,add cond when active|0,0,-1"
                "OnFail" "!activator,$RemoveItemAttribute,reload time increased hidden|0,0,-1"
				"OnFail" "!activator,$RemoveItemAttribute,fire rate bonus HIDDEN|0,0,-1"
            }
        }

        DirectHit_Spawn 
        {
            //ensure rocket is at 1 on spawn
            OnSpawnOutput 
            {
                Target "!activator"
                Action "$Regenerate"
                Delay 0
            }
        }

        DirectHit_Rework_Global 
        {
            NoFixup 1

            //apply cooldown period where you can't reload rocket on hit very briefly
            //to avoid reloading multiple times in 1 tick through splash damage
            $filter_variable
            {
                "targetname" "_direct_hit_not_on_cooldown"
                "$name" "NoDirectHitReload"
                "$value" "1"
                "$compare" "equal"

                "Negated" "1"

                "OnPass" "@e@m_hMyWeapons@!activator,$SetProp$m_iClip1,$$=@e@m_hMyWeapons@!activator.m_iClip1 + 1,0,-1"
                "OnPass" "!activator,$SetVar$NoDirectHitReload,1,-1,-1"
                "OnPass" "!activator,$SetVar$NoDirectHitReload,,0,-1"
            }

            logic_relay 
            {
                "targetname" "direct_hit_on_hit"
                "spawnflags" "2"

                "OnTrigger" "_direct_hit_not_on_cooldown,TestActivator,,0,-1"//"@e@m_hMyWeapons@!activator,$SetProp$m_iClip1,$$=@e@m_hMyWeapons@!activator.m_iClip1 + 1,0,-1"
            }
        }

        Axe_Rework_Global
        {
            NoFixup 1 

            logic_relay 
            {
                "targetname" "axe_kill"
                "spawnflags" "2"

                "OnTrigger" "@c@!activator,$FireUser7,,0,-1"
            }
        }

        Axe_Rework 
        {
            OnSpawnOutput 
            {
                Target "mark_trigger"
                Action "SetParent"
                Param "!activator"
                Delay 0
            }

            filter_activator_tfteam 
			{
				"targetname" "filter_is_blue"
				"Negated" "0"
				"TeamNum" "3"
			}

            logic_relay 
            {
                "targetname" "apply_mark"
                "spawnflags" "2"

                "OnTrigger" "!activator,$AddCond,48,0,-1"

                //won't overlap with vitasaw as the vitasaw is only used on teammates while this can only be used for enemies
                "OnTrigger" "!activator,$CancelPending,OnUser3,0,-1"
                "OnTrigger" "!activator,$RemoveOutput,OnUser3,0,-1"

                "OnTrigger" "!activator,AddOutput,OnUser3 !self:$RemoveCond:48:5:-1,0.01,-1" //duration
                "OnTrigger" "!activator,AddOutput,OnUser3 !self:$RemoveOutput:OnUser3:5.1:-1,0.01,-1" 

                "OnTrigger" "!activator,FireUser3,,0.02,-1" 
            }

            trigger_multiple
            {
                "targetname" "mark_trigger"
                "origin" "0 0 0"
                "mins" "-400 -400 -400"
                "maxs" "400 400 400"
                "spawnflags" "1"

                "filtername" "filter_is_blue"

                "StartDisabled" "1"

                "OnStartTouch" "apply_mark,Trigger,,0,-1"

                "$OnUser7" "!self,Enable,,0,-1"
                "$OnUser7" "!self,Disable,,0.1,-1"
            }
        }

        BannerSticky
        {
            KeepAlive 1

            OnSpawnOutput 
            {
                Target "banner_model"
                Action "SetParent"
                Param ""
                Delay 0
            }

            OnSpawnOutput 
            {
                Target "banner_model"
                Action "$SetLocalAngles"
                Param "0 0 0"
                Delay 0.01
            }

            OnSpawnOutput 
            {
                Target "stickbomb_setposition"
                Action "Trigger"
                Delay 0.02
            }

            OnParentKilledOutput 
            {
                Target "killed"
                Action "Trigger"
                Delay 0
            }

            filter_activator_tfteam 
			{
				"targetname" "filter_is_red"
				"Negated" "0"
				"TeamNum" "2"
			}

            logic_relay
            {
                "targetname" "killed"
                "spawnflags" "2"

                "OnTrigger" "filter_is_red,Kill,,0,-1"
                "OnTrigger" "stickybomb_buff,Kill,,0,-1"
                "OnTrigger" "stickbomb_setposition,Kill,,0,-1"
                "OnTrigger" "banner_model,Kill,,0,-1"

                "OnTrigger" "stickybomb_unapply_buff,Enable,,0,-1"
                "OnTrigger" "stickybomb_unapply_buff,Kill,,0.1,-1"

                "OnTrigger" "!self,Kill,,0.2,-1"
            }

            trigger_multiple
            {
                "targetname" "stickybomb_buff"
                "origin" "0 0 0"
                "mins" "-200 -200 -200"
                "maxs" "200 200 200"
                "spawnflags" "1"

                "filtername" "filter_is_red"

                "OnTrigger" "!activator,$AddCond,16,0,-1"
                "OnEndTouch" "!activator,$RemoveCond,16,0,-1"
            }

            trigger_multiple
            {
                "targetname" "stickybomb_unapply_buff" //unapply buffs on surrounding player on explosion
                "origin" "0 0 0"
                "mins" "-200 -200 -200"
                "maxs" "200 200 200"
                "spawnflags" "1"

                "StartDisabled" "1"

                "filtername" "filter_is_red"

                "OnStartTouch" "!activator,$RemoveCond,16,0,-1"
            }

            logic_relay
            {
                "targetname" "stickbomb_setposition"
                "spawnflags" "2"

                "OnTrigger" "banner_model,$TeleportToEntity,!activator,-1,-1"
                "OnTrigger" "banner_model,$MoveRelative,10 -9 -55,0,-1"

                "OnTrigger" "!self,Trigger,,0.01,-1"
            }

            prop_dynamic
			{
				"targetname" "banner_model"
				"DisableBoneFollowers" "1"
				"disableshadows" "1"
				"model" "models/weapons/c_models/c_buffbanner/c_buffbanner.mdl"
				"solid" "0"
				"spawnflags" "0"
				"StartDisabled" "0"	
			}
        }

        NationalPride_Spawn
        {
            OnSpawnOutput 
            {
                Target "stickies_count_check"
                Action "Trigger"
                Delay 0.1
            }

            // logic_relay
            // {
            //     "targetname" "negate_health_regen"
            //     "spawnflags" "2"

            //     "$OnUser5" "!activator,$TakeDamage,,0.6,-1"
            // }

            // logic_relay
            // {
            //     "targetname" "over_one_sticky"
            //     "spawnflags" "2"

            //     "OnTrigger" "!activator,$AddPlayerAttribute,mod weapon blocks healing|1,0,-1"
            //     "OnTrigger" "!activator,$GetPlayerAttribute,health regen|negate_health_regen|$FireUser5|0,0,-1"
            // }

            logic_case
            {
                "targetname" "stickies_count_handler"

                "Case01" "0"
                "Case02" "1"
                "Case03" "2"
                "Case04" "3"

                "OnCase01" "!activator,$RemoveItemAttribute,no_attack|1,0,-1"
                "OnCase01" "!activator,$RemoveItemAttribute,dmg penalty vs players|0,0,-1"

                "OnCase02" "!activator,$AddItemAttribute,no_attack|1|1,0,-1"
                "OnCase02" "!activator,$AddItemAttribute,dmg penalty vs players|0.7|0,0,-1"

                //"OnCase01" "!activator,$RemovePlayerAttribute,mod weapon blocks healing,0,-1"

                // "OnCase02" "!activator,$TakeDamage,4,0,-1"
                // "OnCase02" "over_one_sticky,Trigger,,0,-1"
                // "OnCase03" "!activator,$TakeDamage,5,0,-1"
                // "OnCase03" "over_one_sticky,Trigger,,0,-1"
                // "OnCase04" "!activator,$TakeDamage,6,0,-1"
                // "OnCase04" "over_one_sticky,Trigger,,0,-1"
            }

            logic_relay
            {
                "targetname" "stickies_count_check"
                "spawnflags" "2"

                "OnTrigger" "@e@m_hMyWeapons$1@!activator,$GetProp$m_iPipebombCount,stickies_count_handler|InValue|-1,0,-1"

                "OnTrigger" "!self,Trigger,,0.1,-1"
            }
        }

        Natascha_Spawn
        {
            OnSpawnOutput 
            {
                Target "filter_rage_activated"
                Action "FireUser1"
                Delay 0
            }

            OnParentKilledOutput 
            {
                Target "!activator"
                Action "$ResetClientProp$m_bRageDraining"
                Delay 0.1
            }

            OnParentKilledOutput 
            {
                Target "!activator"
                Action "$ResetClientProp$m_flRageMeter"
                Delay 0.1
            }

            //check when rage was activated by player
            $filter_sendprop
            {
                "targetname" "filter_rage_activated"
                "$name" "m_bRageDraining"
                "$value" "1"
                "$compare" "equal"
                "Negated" "0"

				"OnPass" "rage_activated,Trigger,,0,-1"
				//"OnPass" "player,$DisplayTextChat,activated,0,-1"

                "OnUser1" "!self,TestActivator,,0,-1"
                "OnUser1" "!self,FireUser1,,0.1,-1"
            }

            logic_relay 
            {
                "targetname" "rage_activated"
                "spawnflags" "2"

                "OnTrigger" "!activator,$SetClientProp$m_bRageDraining,1,0,-1"
                "OnTrigger" "!activator,$SetProp$m_bRageDraining,0,0,-1"

                "OnTrigger" "!activator,$AddCond,11,0,-1"

                "OnTrigger" "rage_meter,SetValueNoFire,$$=!activator.m_flRageMeter,0,-1"
                "OnTrigger" "rage_meter_drain,FireUser1,,0.01,-1"
            }

            logic_relay 
            {
                "targetname" "rage_meter_drain"
                "spawnflags" "2"

                "OnUser1" "rage_meter,FireUser1,,0,-1"
                "OnUser1" "!self,FireUser1,,0.1,-1" //interval
            }

            math_counter
			{
				"targetname" "rage_meter"
				"startvalue" "0"
				"min" "0"
				"max" "100" 

				"OnHitMin" "rage_meter_drain,$CancelPending,,0,0"

                "OnHitMin" "!activator,$RemoveCond,11,0,-1"
				"OnHitMin" "!activator,$SetClientProp$m_bRageDraining,0,0,-1"
				"OnHitMin" "!activator,$ResetClientProp$m_flRageMeter,,0.03,-1"
				"OnHitMin" "!activator,$SetProp$m_flRageMeter,0,0,-1"

				//"OnHitMin" "player,$DisplayTextChat,rage meter ended,0,-1"

				"OnGetValue" "rage_meter,$SetVar$tempRageHolder,,0,-1"
				"OnGetValue" "!activator,$SetClientProp$m_flRageMeter,$$=rage_meter.tempRageHolder,0.01,-1"

				"OnUser1" "!self,Subtract,1,0,-1" //drain per interval
				"OnUser1" "!self,GetValue,,0.01,-1"
			}
        }

        Thunderdome_Spawn
        {
            OnSpawnOutput
            {
                Target "!activator"
                Action "$AddItemAttribute"
                Param "CARD: damage bonus|1.25|1"
                Delay 0
            }

            OnSpawnOutput
            {
                Target "!activator"
                Action "$AddItemAttribute"
                Param "CARD: damage bonus|1.25|2"
                Delay 0
            }

            OnParentKilledOutput
            {
                Target "!activator"
                Action "$RemoveItemAttribute"
                Param "CARD: damage bonus|1"
                Delay 0
            }

            OnParentKilledOutput
            {
                Target "!activator"
                Action "$RemoveItemAttribute"
                Param "CARD: damage bonus|2"
                Delay 0
            }

            // OnSpawnOutput
            // {
            //     Target "@e@m_hMyWeapons@!activator"
            //     Action "$SetProp$m_iClip1"
            //     Param "0"
            //     Delay 0
            // }

            //very weird hack to prevent switching to weapon
            // OnSpawnOutput
            // {
            //     Target "@e@m_hMyWeapons@!activator"
            //     Action "$SetProp$m_bFlipViewModel"
            //     Param "0"
            //     Delay 0.01
            // }

            OnSpawnOutput
            {
                Target "!activator"
                Action "$WeaponSwitchSlot"
                Param "1"
                Delay 0
            }

            OnSpawnOutput
            {
                Target "shield_hitbox"
                Action "$SetOwner"
                Param "!activator"
            }

            OnSpawnOutput
            {
                Target "shield_hitbox2"
                Action "$SetOwner"
                Param "!activator"
            }

            OnSpawnOutput
            {
                Target "projectile_shield"
                Action "$SetModel"
                Param "models/props_mvm/mvm_comically_small_player_shield.mdl"
            }

            OnSpawnOutput
            {
                Target "rotate"
                Action "Start"
            }

            OnSpawnOutput
            {
                Target "rotate2"
                Action "Start"
            }

            OnSpawnOutput
            {
                Target "rotate"
                Action "SetParent"
                Param ""
            }

            OnSpawnOutput
            {
                Target "rotate2"
                Action "SetParent"
                Param ""
            }

            OnSpawnOutput
            {
                Target "rotate_position"
                Action "Trigger"
            }

            filter_activator_tfteam 
			{
				"targetname" "filter_is_blue"
				"Negated" "0"
				"TeamNum" "3"
			}

            logic_relay
            {
                "targetname" "rotate_position"
                "spawnflags" "2"

                "OnTrigger" "rotate,$TeleportToEntity,!activator,0,-1"
                "OnTrigger" "rotate2,$TeleportToEntity,!activator,0,-1"

                "OnTrigger" "!self,Trigger,,0.01,-1"
            }

            trigger_hurt
            {
                "parentname" "rotate"
                "origin" "100 0 1"
                "mins" "-12 -53 -51.5"
                "maxs" "12 53 51.5"

                "targetname" "shield_hitbox"
                "spawnflags" "1"


                "filtername" "filter_is_blue"

                "Damage" "60" //damage is half of this
                "damagetype" "512"
            }

			entity_medigun_shield
			{
                "parentname" "rotate"
                "targetname" "projectile_shield"
				"origin" "100 0 0"
				"spawnflags" "1"
				"teamnum" "2"
			}

            func_rotating
            {
                "targetname" "rotate"
                "origin" "0 0 0"

                "mins" "-0.1 -0.1 -0.1"
                "maxs" "0.1 0.1 0.1"

                "dmg" "0"
                "fanfriction" "100" 
                "maxspeed" "60"
                "spawnflags" "64"
                "volume" "0"
            }

            //2nd shield
            trigger_hurt
            {
                "parentname" "rotate2"
                "mins" "-12 -53 -51.5"
                "maxs" "12 53 51.5"
                "origin" "-100 0 1"
                // "angles" "180 0 0"

                "targetname" "shield_hitbox2"
                "spawnflags" "1"

                "filtername" "filter_is_blue"

                "Damage" "60" //damage is half of this
                "damagetype" "512"
            }

			entity_medigun_shield
			{
                "parentname" "rotate2"
                "targetname" "projectile_shield"
				"origin" "-100 0 0"
                "angles" "-180 0 -180"
				"spawnflags" "1"
				"teamnum" "2"
			}

            func_rotating
            {
                "targetname" "rotate2"
                "origin" "0 0 0"

                "mins" "-0.1 -0.1 -0.1"
                "maxs" "0.1 0.1 0.1"

                "dmg" "0"
                "fanfriction" "100" 
                "maxspeed" "60"
                "spawnflags" "64"
                "volume" "0"
            }
        }

        Building_Level2_Spawn
        {
            OnSpawnOutput
            {
                Target constructed_check_loop
                Action Trigger 
                Delay 0.1
            }

            $filter_sendprop
            {
                "targetname" "filter_constructed"
                "$name" "m_flPercentageConstructed"
                "$value" "1"
                "$compare" "greater than or equal"
                "Negated" "0"

                "OnPass" "apply_level2,Trigger,,0,-1"
            }

            //if building was built in setup or player used building canteen, cancel
            $filter_sendprop
            {
                "targetname" "filter_is_already_constructed"
                "$name" "m_iHighestUpgradeLevel"
                "$value" "2"
                "$compare" "greater than or equal"
                "Negated" "0"

                "OnPass" "constructed_check_loop,Disable,,0,-1"
            }

            logic_relay 
            {
                "targetname" "constructed_check_loop"
                "spawnflags" "2"

                "OnTrigger" "filter_constructed,TestActivator,,0,-1"
                "OnTrigger" "filter_is_already_constructed,TestActivator,,0,-1"

                "OnTrigger" "!self,Trigger,,0.1,-1"
            }

            logic_relay 
            {
                "targetname" "apply_level2"
                "spawnflags" "2"

                "OnTrigger" "!activator,$SetProp$m_iHighestUpgradeLevel,2,0,-1"

                "OnTrigger" "constructed_check_loop,Disable,,0,-1"
            }
        }

        Vitasaw_Rework_Spawn 
        {
			OnSpawnOutput
			{
				Target "vita_relay"
				Action "Trigger"
			}

			logic_relay 
			{
				"targetname" "vita_relay"
				"spawnflags" "2"

				
				"OnTrigger" "filter_has_enough_organs,TestActivator,,0,-1"
				"OnTrigger" "!self,Trigger,,0.2,-1"
			}

            $filter_sendprop
            {
                "targetname" "filter_has_enough_organs"
                "$name" "m_iDecapitations"
                "$value" "3"
                "$compare" "greater than or equal"
                "Negated" "0"

				"OnPass" "!activator,$AddItemAttribute,allow friendly fire|1|2,0,-1"

				"OnFail" "!activator,$RemoveItemAttribute,allow friendly fire|2,0,-1"
            }
        }

        Vitsaw_Rework_Global 
        {
            NoFixup 1

            logic_relay 
            {
                "targetname" "_vita_duration"
                "spawnflags" "2"

                "OnTrigger" "!activator,$RemoveCond,16,5,-1"
                "OnTrigger" "!activator,$RemoveCond,29,5,-1"
                "OnTrigger" "!activator,$RemoveCond,26,5,-1"
            }

            filter_activator_tfteam
            {
                "targetname" "vitasaw_team_check"

                "TeamNum" "2"//red

                "OnPass" "vitasaw_caller,$SetProp$m_iDecapitations,$$=vitasaw_caller.m_iDecapitations - 3,0.01,-1"
                "OnPass" "vitasaw_caller,AddOutput,targetname  ,0.011,-1"

                "OnPass" "!activator,$AddCond,16,0,-1"
                "OnPass" "!activator,$AddCond,29,0,-1"
                "OnPass" "!activator,$AddCond,26,0,-1"

                "OnPass" "!activator,$CancelPending,,0,-1"
                "OnPass" "!activator,$RemoveOutput,OnUser4,0,-1"

                "OnPass" "!activator,AddOutput,OnUser4 !self:$RemoveCond:16:5:-1,0.01,-1" 
                "OnPass" "!activator,AddOutput,OnUser4 !self:$RemoveCond:29:5:-1,0.01,-1" 
                "OnPass" "!activator,AddOutput,OnUser4 !self:$RemoveCond:26:5:-1,0.01,-1" 
                "OnPass" "!activator,AddOutput,OnUser4 !self:$RemoveOutput:OnUser4:5.1:-1,0.01,-1" 

                "OnPass" "!activator,FireUser4,,0.02,-1" 
            }
        }

        Explosive_Tip
        {
            KeepAlive 1

            OnSpawnOutput 
            {
                Target "tip_explosion"
                Action "$InheritOwner"
                Param "!activator"
                Delay 0.1
            }

            OnSpawnOutput 
            {
                Target "getdamage"
                Action "Trigger"
                Delay 0.01
            }

            // OnParentKilledOutput 
            // {
            //     Target "@c@!activator"
            //     Action "FireUser1"
            //     Delay 0
            // }

            OnParentKilledOutput 
            {
                Target "explosive_tip_relay"
                Action "FireUser1"
                Delay 0
            }

            logic_relay
            {
                "targetname" "getdamage"

                "OnTrigger" "tip_explosion,$SetVar$baseDamage,75,0,-1"
                "OnTrigger" "@e@m_hOwnerEntity@!activator,$GetItemAttribute,0|damage bonus|setdamage|$FireUser5|1,0.01,-1"
            }

            logic_relay
            {
                "targetname" "setdamage"

                "$OnUser5" "!self,$SetVar$DamageMult,,0,-1"
                "$OnUser5" "tip_explosion,$SetKey$Damage,$$=setdamage.DamageMult * tip_explosion.baseDamage,0.03,-1"
                //"$OnUser5" "player,$DisplayTextChat,$$=setdamage.DamageMult * tip_explosion.baseDamage,0.03,-1"
            }

            logic_relay
            {
                "targetname" "explosive_tip_relay"

                "OnUser1" "tip_explosion,FireUser1,,0,-1"
                "OnUser1" "sticky_flicker,FireUser1,,0,-1"
                "OnUser1" "sticky_sound,FireUser1,,0,-1"
                "OnUser1" "attach_to_enemy,FireUser1,,0,-1"
                "OnUser1" "detonate_position,FireUser1,,0,-1"

                "OnUser1" "measure,Kill,,4,-1"
                "OnUser1" "!self,Kill,,5,-1"
            }

            info_target
            {
                "targetname" "detonate_position"

                "OnUser1" "!self,Kill,,5,-1"
            }

            tf_point_weapon_mimic
            {
                "targetname" "tip_explosion"

                "spawnflags" "1"
                "angles" "0 0 0"
                "origin" "-1 0 -3"
                "teamnum" "2"
                "Crits" "0"
                "Damage" "0"
                "ModelScale" "1"
                "SpeedMax" "1000000"
                "SpeedMin" "1000000"
                "SplashRadius" "144"
                "SpreadAngle" "0"
                "WeaponType" "3"

                "OnUser1" "!self,FireOnce,,2,-1"
                "OnUser4" "!self,DetonateStickies,,0,-1"
            }
            
            logic_measure_movement 
            {
                "targetname" "measure"

                "MeasureReference" "detonate_position"
                "MeasureTarget" "detonate_position"
                "MeasureType" "0"
                "Target" "tip_explosion"
                "TargetReference" "detonate_position"
                "TargetScale" "1"
            }

			info_particle_system
			{
				"targetname" "sticky_flicker"
				"effect_name" "stickybomb_pulse_red"
				"flag_as_weather" "0"
				"start_active" "0"
				
				"OnUser1" "!self,Start,2,1,-1"
				"OnUser1" "!self,Kill,2.7,3,-1"
			}

            logic_measure_movement 
            {
                "targetname" "measure"

                "MeasureReference" "detonate_position"
                "MeasureTarget" "detonate_position"
                "MeasureType" "0"
                "Target" "sticky_flicker"
                "TargetReference" "detonate_position"
                "TargetScale" "1"
            }

            ambient_generic
            {
                "targetname" "sticky_sound"
                "message" "weapons/stickybomblauncher_det.wav"
                "radius" "4000"
                "health" "5"
                "spawnflags" "48"

                "OnUser1" "!self,PlaySound,,1,-1"
                "OnUser1" "!self,Kill,,3,-1"
            }

            logic_measure_movement 
            {
                "targetname" "measure"

                "MeasureReference" "detonate_position"
                "MeasureTarget" "detonate_position"
                "MeasureType" "0"
                "Target" "sticky_sound"
                "TargetReference" "detonate_position"
                "TargetScale" "1"
            }

            filter_activator_tfteam 
            {
                "targetname" "filter_is_blu"
                "Negated" "0"
                "TeamNum" "3"

                "OnUser1" "!self,Kill,,2.1,-1"
            }	

            trigger_hurt //for some reason I can't explain using a trigger_once or trigger_multiple just blocks the projectile
            {
                "targetname" "attach_to_enemy"
                "origin" "0 0 0"
                "mins" "-3 -3 -3"
                "maxs" "3 3 3"
                "Damage" "0"
                "spawnflags" "1" 
                "filtername" "filter_is_blu"

                "OnStartTouch" "detonate_position,SetParent,!activator,0.1,-1"
                "OnStartTouch" "!self,Disable,,0,-1"

                "OnUser1" "!self,Kill,,2.1,-1"
            }
        }

        KirinAscension_Spawn 
        {
            OnSpawnOutput
			{
				Target "cloak_check"
				Action "Trigger"
			}

            filter_tf_condition
			{
				"targetname" "filter_is_cloaking"
				"Negated" "0"
				"condition" "4"

                "OnPass" "!activator,$RemoveCond,3,0,-1" //remove disguise
                "OnPass" "!activator,$AddCond,72,0,-1"
                "OnPass" "!activator,$AddPlayerAttribute,cannot disguise|1,0,-1"

                "OnFail" "!activator,$RemoveCond,72,0,-1"
                "OnFail" "!activator,$RemovePlayerAttribute,cannot disguise,0,-1"
			}

            logic_relay 
            {
                "targetname" "cloak_check"
                "spawnflags" "2"

                "OnTrigger" "filter_is_cloaking,TestActivator,,0,-1"    
                "OnTrigger" "!self,Trigger,,0.05,-1"  
            }
        }
	}

	ExtraSpawnPoint  
	{
		Name "red"
		TeamNum 3
		X "2408.000000" 
		Y "-96.000000" 
		Z "267.031311"
	}

    SpawnTemplate DirectHit_Rework_Global
    SpawnTemplate Axe_Rework_Global
    SpawnTemplate Vitsaw_Rework_Global

    CustomWeapon 
	{
        "Thunderdome" //name suggested by yuugi
        {
            OriginalItemName "Upgradeable TF_WEAPON_MINIGUN" 

            "hidden primary max ammo bonus" 0.0001
            "cannot be upgraded" 1
            "special item description" "Create 2 small projectile shields that orbit around you and damage enemies"
            "special item description 2" "Increased damage for secondary and melee"
            "special item description 3" "No primary weapon"
        }

        "National Pride"
        {
            OriginalItemName "Upgradeable TF_WEAPON_PIPEBOMBLAUNCHER"

            "provide on active" 1 //for no_attack

            "paintkit_proto_def_index" 209 //clover camo'd
            "set_item_texture_wear" 0

            "stickybomb fizzle time" 10
            "clip size penalty" 0.1
            "Reload time increased" 1.7
            "max pipebombs decreased" -7
            "sticky arm time penalty" 5000
            "damage penalty" 0

            "special item description" "Stickybombs grant minicrit to nearby teammates"
            "special item description 2" "Cannot detonate. only 1 sticky can be active at a time"
            "special item description 3" "-30% damage on primary weapon when at least 1 stickybomb is active"
        }

        "Kirin's Ascension"
        {
            OriginalItemName "TF_WEAPON_INVIS" //using Upgradeable mess with things for some reason

            "mult cloak rate" 50
            "mult decloak rate" 0.001
    
            "special item description" "On Cloak: Remove disguise and gain a speed boost with infinite air jumps"
            "special item description 2" "No disguise while active"
            "special item description 3" "No cloak effect"
        }

		"Rider On The Storm" 
		{
			OriginalItemName "Activated Campaign 3 Pass" 
            "increased air control" 3
            "dmg from ranged reduced" 0.9
			// "dmg taken from bullets reduced" 0.9
			// "dmg taken from blast reduced" 0.9
			// "dmg taken from fire reduced" 0.9
            "damage force increase" 2
            "cancel falling damage" 1
            "custom item model" "models/player/items/all_class/spacechem_pin.mdl"
		}

        "Freelance Mercenary" 
		{
			OriginalItemName "Halloween Spellbook" 
            "special item description" "Hold the Action key to switch between classes on the fly"
		}
	}

    ExtraLoadoutItems 
	{
		Scout 
		{
			Action {Item "Rider On The Storm" Cost 10}
		}

        Demoman 
        {
            Secondary {Item "National Pride"}
        }

		Heavyweapons
		{
			Primary {Item "Thunderdome"}
		}

		Spy 
		{
            PDA2 {Item "Kirin's Ascension"}
			Action {Item "Rider On The Storm" Cost 10}
		}

        Action {Item "Freelance Mercenary" Cost 100}
	}

    PlayerItemEquipSpawnTemplate 
	{
		Name FreelanceMercenary_Logic
		ItemName "Freelance Mercenary"
	}

    PlayerItemEquipSpawnTemplate 
	{
		Name BabyFace_Spawn
		ItemName "Baby Face's Blaster"
	}

    ItemAttributes 
	{
		ItemName "Baby Face's Blaster"

        "special item description" "Initial Scout: Gain increase to reload and fire rate while at full boost"
	}
    
    PlayerItemEquipSpawnTemplate 
	{
		Name DirectHit_Spawn
		ItemName "The Direct Hit"
	}

    ItemAttributes 
	{
		ItemName "The Direct Hit"
		"fire input on hit" "direct_hit_on_hit^Trigger^"
        "clip size penalty" 0.25

        "special item description" "On Hit: Instantly reload one rocket"
	}

    PlayerItemEquipSpawnTemplate 
	{
		Name Axe_Rework
		ItemName "The Axtinguisher"
	}

    ItemAttributes 
	{
		ItemName "The Axtinguisher"

        "fire input on kill" "axe_kill^Trigger^"

        "special item description" "On Kill: Mark for death enemies within 400 hammer units for 5 seconds"
	}
    PlayerItemEquipSpawnTemplate 
	{
		Name Axe_Rework
		ItemName "Festive Axtinguisher"
	}

    ItemAttributes 
	{
		ItemName "Festive Axtinguisher"

        "fire input on kill" "axe_kill^Trigger^"

        "special item description" "On Kill: Mark for death enemies within 400 hammer units for 5 seconds"
	}
    PlayerItemEquipSpawnTemplate 
	{
		Name Axe_Rework
		ItemName "The Postal Pummeler"
	}
    ItemAttributes 
	{
		ItemName "The Postal Pummeler"

        "fire input on kill" "axe_kill^Trigger^"

        "special item description" "On Kill: Mark for death enemies within 400 hammer units for 5 seconds"
	}

    PlayerShootTemplate
	{
		Name BannerSticky
        AttachToProjectile 1
		ItemName "National Pride"
	}

    PlayerItemEquipSpawnTemplate 
	{
		Name NationalPride_Spawn
		ItemName "National Pride"
	}
    
    PlayerItemEquipSpawnTemplate 
	{
		Name Natascha_Spawn
		ItemName "Natascha"
	}

    PlayerItemEquipSpawnTemplate 
	{
		Name Thunderdome_Spawn
		ItemName "Thunderdome"
	}

    ItemAttributes 
	{
		ItemName "Natascha"
		"increase buff duration HIDDEN" 50
        //"generate rage on damage" 3

        "special item description" "Replaces 'Knockback Rage' with Power Rage. grant crit while active (PLACEHOLDER EFFECT)"
	}

    ItemAttributes 
	{
        ClassName TF_WEAPON_PDA_ENGINEER_BUILD
		"special item description" "Buildings start at level 2 after construction"
	}


    BuildingSpawnTemplate
	{
		Name Building_Level2_Spawn
		BuildingType "Sentry" 
	}

    BuildingSpawnTemplate
	{
		Name Building_Level2_Spawn
		BuildingType "Dispenser" 
	}
    BuildingSpawnTemplate
	{
		Name Building_Level2_Spawn
		BuildingType "Teleporter Entry" 
	}
    BuildingSpawnTemplate
	{
		Name Building_Level2_Spawn
		BuildingType "Teleporter Exit" 
	}

    PlayerItemEquipSpawnTemplate 
	{
		Name Vitasaw_Rework_Spawn
		ItemName "The Vita-Saw"
	}

    ItemAttributes 
	{
		ItemName "The Vita-Saw"

        "fire input on hit" "popscript^$vitasawOnHit^vitasaw_team_check"
		
        "damage penalty" 0.09
        "max health additive penalty" 0

		"special item description" "On Hit Teammate: Exchange 3 organs to give target every banner effects for 5 seconds"
	}

	PlayerShootTemplate
	{
		Name Explosive_Tip 
		AttachToProjectile 1 
		Classname "tf_weapon_compound_bow"
	}

    ItemAttributes
    {
        Classname "tf_weapon_Compound_Bow"
        "arrow hit kill time" 0.01
        "special item description" "Fires explosive arrows that stick to enemies and surfaces. Arrows detonate after 3 seconds"
    }

    PlayerItemEquipSpawnTemplate 
	{
		Name KirinAscension_Spawn
		ItemName "Kirin's Ascension"
	}

	Wave 
	{
		StartWaveOutput
		{
			Target wave_start_relay
			Action Trigger
		}
		DoneOutput
		{
			Target wave_finished_relay
			Action Trigger
		}

			// WaveSpawn 
		// {
		//   Where spawnbot  
		//   TotalCount 1
		//   MaxActive 1
		//   SpawnCount 1
		//   WaitBetweenSpawns 0
		//   WaitBeforeStarting 0
		//   TotalCurrency 0

		//   TFBot
		//   {
			// 		SpawnTemplate "Tank_Carrier_Base"

		//     Class Medic
		//     Health 1
		//     WeaponRestrictions PrimaryOnly
		//     Attributes MiniBoss
		//     CharacterAttributes
		//     {
		//       "move speed bonus"	2
		//       "damage force reduction" 0.7
		//       "airblast vulnerability multiplier" 0.7
		//       "override footstep sound set" 5
		//     }
		//   }
		// }

		WaveSpawn 
		{
		    Where spawnbot  
			TotalCount 1
			MaxActive 1
			SpawnCount 1
			WaitBetweenSpawns 0
			WaitBeforeStarting 0.1
			TotalCurrency 0

			Tank
			{
				Health 1000
				Speed 0
				Name "tankboss"
				StartingPathTrackNode "path_tank_a"

				OnKilledOutput
				{
				Target boss_dead_relay
				Action Trigger
				}

				OnBombDroppedOutput
				{
				Target boss_deploy_relay
				Action Trigger
				}
			}
		}

        WaveSpawn 
		{
		    Where spawnbot  
			TotalCount 50
			MaxActive 5
			SpawnCount 5
			WaitBetweenSpawns 0
			WaitBeforeStarting 0
			TotalCurrency 0

			TFBot
            {
                Class heavyballsacks

                Action Mobber

                CharacterAttributes
                {
                    "no_attack" 1
                }
            }
		}

        WaveSpawn 
		{
		    Where red  
			TotalCount 50
			MaxActive 2
			SpawnCount 2
			WaitBetweenSpawns 0
			WaitBeforeStarting 0
			TotalCurrency 0

			TFBot
            {
                Class heavyballsacks

                Action Mobber

                CharacterAttributes
                {
                    "no_attack" 1
                }

                AddCond {Index 43}
            }
		}

        WaveSpawn 
		{
		    Where spawnbot  
			TotalCount 50
			MaxActive 2
			SpawnCount 2
			WaitBetweenSpawns 0
			WaitBeforeStarting 0
			TotalCurrency 0

			TFBot
            {
                Attributes MiniBoss

                Health 3000
                
                Class heavyballsacks

                Action Mobber

                CharacterAttributes
                {
                    "no_attack" 1
                }
            }
		}
	}

    Wave 
	{
		StartWaveOutput
		{
			Target wave_start_relay
			Action Trigger
		}
		DoneOutput
		{
			Target wave_finished_relay
			Action Trigger
		}

		WaveSpawn 
		{
		    Where spawnbot  
			TotalCount 1
			MaxActive 1
			SpawnCount 1
			WaitBetweenSpawns 0
			WaitBeforeStarting 0.1
			TotalCurrency 0

			Tank
			{
				Health 1000
				Speed 0
				Name "tankboss"
				StartingPathTrackNode "path_tank_a"

				OnKilledOutput
				{
				Target boss_dead_relay
				Action Trigger
				}

				OnBombDroppedOutput
				{
				Target boss_deploy_relay
				Action Trigger
				}
			}
		}

        WaveSpawn 
		{
		    Where spawnbot  
			TotalCount 50
			MaxActive 3
			SpawnCount 3
			WaitBetweenSpawns 0
			WaitBeforeStarting 0
			TotalCurrency 0

			TFBot
            {
                Class soldier

                Action Mobber

                // CharacterAttributes
                // {
                //     "no_attack" 1
                // }
            }
		}

        WaveSpawn 
		{
		    Where red  
			TotalCount 50
			MaxActive 2
			SpawnCount 2
			WaitBetweenSpawns 0
			WaitBeforeStarting 0
			TotalCurrency 0

			TFBot
            {
                Class heavyballsacks

                Action Mobber

                CharacterAttributes
                {
                    "no_attack" 1
                }

                AddCond {Index 43}
            }
		}
	}
}